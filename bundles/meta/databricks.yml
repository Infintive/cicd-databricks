bundle:
  name: meta_bundle

include:
  - resources/schemas/*.yml
  - resources/volumes/*.yml
  - resources/jobs/*.yml

sync:
  paths:
    - ../../databricks_notebooks/CONFIG
    - ../../databricks_notebooks/UTIL
    - .

variables:
  SP_NAME:
    description: "The service principal ID managing this deployment"
  JC_POLICY_ID:
    description: "The job policy to attach to job compute clusters"
  ENV:
    description: "The environment (dev, qat, stg, prd)"
  CICD_ENV:
    description: "The environment with the cicd suffix for catalog names"
    default: "${var.ENV}_cicd"
  DEVELOPMENT_MODE:
    description: The mode to run in when in development
    default: production

permissions:
  - service_principal_name: ${var.SP_NAME}
    level: CAN_MANAGE

targets:

  dev: &target_env
    default: true
    mode: ${var.DEVELOPMENT_MODE}
    workspace:
      root_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}
    permissions:
      - group_name: dbrx-DataStrategy
        level: CAN_MANAGE

  qat: 
    <<: *target_env
    default: false
    variables:
      CICD_ENV: ${var.ENV}

  stg: 
    <<: *target_env
    default: false
    variables:
      CICD_ENV: ${var.ENV}

  prd: 
    <<: *target_env
    default: false
    variables:
      CICD_ENV: ${var.ENV}
